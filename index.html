<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <title>The Import House | Premium Global Fashion</title>

    <meta property="og:site_name" content="The Import House">
    <meta property="og:title" content="The Import House | Premium Global Fashion">
    <link rel="icon" type="image/webp" href="theimporthouse.webp">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] }, colors: { brand: '#000000' }, height: { 'screen-dvh': '100dvh' } } } }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap');
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; background: #fff; -webkit-tap-highlight-color: transparent; }
        .section-hidden { display: none !important; }
        .section-active { display: block !important; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* SUCCESS TICK */
        .checkmark-circle { width: 80px; height: 80px; position: relative; display: inline-block; vertical-align: top; margin-bottom: 20px; }
        .checkmark-circle .background { width: 80px; height: 80px; border-radius: 50%; background: #22c55e; position: absolute; }
        .checkmark-circle .checkmark { border-radius: 5px; }
        .checkmark-circle .checkmark.draw:after { animation-delay: 100ms; animation-duration: 1s; animation-timing-function: ease; animation-name: checkmark; transform: scaleX(-1) rotate(135deg); animation-fill-mode: forwards; }
        .checkmark-circle .checkmark:after { opacity: 1; height: 40px; width: 20px; transform-origin: left top; border-right: 4px solid white; border-top: 4px solid white; content: ''; left: 22px; top: 40px; position: absolute; border-width: 4px; border-style: solid; border-color: white; border-top: none; border-right: none; transform: rotate(-45deg); }
        @keyframes checkmark { 0% { height: 0; width: 0; opacity: 1; } 20% { height: 0; width: 20px; opacity: 1; } 40% { height: 40px; width: 20px; opacity: 1; } 100% { height: 40px; width: 20px; opacity: 1; transform: scaleX(-1) rotate(135deg); } }

        /* SNOW & SLIDER */
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20; display: none; }
        .snowflake { position: absolute; top: -10px; background: #cbd5e1; border-radius: 50%; opacity: 0.9; animation: fall linear infinite; }
        @keyframes fall { 0% { transform: translateY(-10px) translateX(0px); opacity: 0.9; } 100% { transform: translateY(100vh) translateX(20px); opacity: 0; } }
        .slider-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; transition: transform 0.7s cubic-bezier(0.25, 1, 0.5, 1); z-index: 0; }
        .slide { min-width: 100%; height: 100%; position: relative; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        .slide::after { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.4); }
    </style>
</head>
<body class="text-slate-900">

    <div id="snow-container"></div>
    <div id="slider-track" class="slider-wrapper">
        <div class="slide"><img src="https://images.unsplash.com/photo-1548624313-0396c75e4b1a?auto=format&fit=crop&w=1600&q=80"></div>
        <div class="slide"><img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?auto=format&fit=crop&w=1600&q=80"></div>
        <div class="slide"><img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1600&q=80"></div>
    </div>
    <div id="slider-controls" class="fixed inset-0 z-10 pointer-events-none flex items-center justify-between px-4">
        <button onclick="prevSlide()" class="pointer-events-auto w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white"><i class="ph ph-caret-left text-xl"></i></button>
        <button onclick="nextSlide()" class="pointer-events-auto w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white"><i class="ph ph-caret-right text-xl"></i></button>
    </div>
    <div id="intro-overlay" class="fixed inset-0 z-[200] flex pointer-events-none">
        <div id="door-left" class="w-1/2 h-full bg-black flex items-center justify-end border-r border-gray-800 relative z-20"><span class="text-white text-3xl font-black mr-4">IMPORT</span></div>
        <div id="door-right" class="w-1/2 h-full bg-black flex items-center justify-start relative z-20"><span class="text-white text-3xl font-black ml-4">HOUSE</span></div>
    </div>

    <div id="payment-modal" class="fixed inset-0 z-[300] bg-black/90 hidden items-center justify-center px-4 flex">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center relative">
            <button onclick="closeModal('payment-modal')" class="absolute top-4 right-4 text-gray-400"><i class="ph ph-x text-2xl"></i></button>
            <h2 class="text-2xl font-black mb-1">Scan to Pay</h2>
            <p class="text-gray-500 text-sm mb-6">Total: <span id="modal-total" class="font-bold text-black text-lg">₹0</span></p>
            <div class="bg-gray-100 p-4 rounded-2xl mb-6 mx-auto w-64 h-64 flex items-center justify-center">
                <img src="qrcode.jpg" class="w-full h-full object-contain mix-blend-multiply">
            </div>
            <button onclick="processOrder('Online')" class="w-full bg-green-600 text-white font-bold py-4 rounded-full">Payment Completed</button>
        </div>
    </div>

    <div id="success-modal" class="fixed inset-0 z-[300] bg-black/90 hidden items-center justify-center px-4 flex">
        <div class="bg-white w-full max-w-sm rounded-3xl p-8 text-center relative">
            <div class="checkmark-circle"><div class="background"></div><div class="checkmark"></div></div>
            <h2 class="text-2xl font-black mb-2">Order Confirmed!</h2>
            <p class="text-gray-500 text-sm mb-6">We have received your order.</p>
            <button onclick="resetApp()" class="w-full bg-black text-white font-bold py-3 rounded-full">Continue Shopping</button>
        </div>
    </div>

    <div id="auth-container" class="fixed inset-0 z-[150] bg-white flex overflow-hidden">
        <div class="hidden lg:block w-1/2 h-full relative bg-gray-100"><img src="theimporthouse.webp" class="w-full h-full object-cover opacity-50"></div>
        <div class="w-full lg:w-1/2 h-full relative flex items-center justify-center p-6 bg-white">
            <div id="login-form" class="max-w-md w-full">
                <div class="mb-10 text-center"><img src="theimporthouse.webp" class="w-20 mx-auto mb-4"><h1 class="text-4xl font-black">Welcome Back.</h1></div>
                <form onsubmit="handleLogin(event)" class="space-y-6">
                    <input id="login-email" type="email" placeholder="Email" class="w-full p-3 border rounded-lg">
                    <input id="login-password" type="password" placeholder="Password" class="w-full p-3 border rounded-lg">
                    <button type="submit" class="w-full bg-black text-white font-bold py-3 rounded-full">Sign In</button>
                </form>
                <p class="mt-6 text-center text-sm">No account? <button onclick="toggleAuth('signup')" class="font-bold underline">Sign Up</button></p>
            </div>
            <div id="signup-form" class="max-w-md w-full hidden">
                <h1 class="text-4xl font-black mb-6">Create Account.</h1>
                <form onsubmit="handleSignup(event)" class="space-y-4">
                    <input id="reg-name" type="text" placeholder="First Name" class="w-full p-3 border rounded-lg">
                    <input id="reg-surname" type="text" placeholder="Last Name" class="w-full p-3 border rounded-lg">
                    <input id="reg-email" type="email" placeholder="Email" class="w-full p-3 border rounded-lg">
                    <input id="reg-password" type="password" placeholder="Password" class="w-full p-3 border rounded-lg">
                    <button type="submit" class="w-full bg-black text-white font-bold py-3 rounded-full">Register</button>
                </form>
                <p class="mt-6 text-center text-sm">Member? <button onclick="toggleAuth('login')" class="font-bold underline">Sign In</button></p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <nav class="fixed top-0 w-full z-[100] bg-white/90 backdrop-blur-md border-b border-gray-100">
            <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
                <div onclick="switchView('home')" class="cursor-pointer font-black text-xl">THE IMPORT HOUSE</div>
                <div class="flex gap-4">
                    <i onclick="switchView('shop')" class="ph ph-storefront text-xl"></i>
                    <i onclick="switchView('profile')" class="ph ph-user text-xl"></i>
                    <div class="relative" onclick="switchView('cart')">
                        <i class="ph ph-shopping-bag text-xl"></i>
                        <span id="cart-badge" class="absolute -top-2 -right-2 bg-black text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center hidden">0</span>
                    </div>
                </div>
            </div>
        </nav>

        <section id="home-view" class="section-active min-h-[100dvh] relative flex flex-col pt-24 pb-4 z-20 justify-between">
            <div class="flex-1 flex flex-col justify-center items-center text-center px-4">
                <div class="mb-4 px-3 py-1 rounded-full border border-white/30 bg-black/30 backdrop-blur-md text-[10px] text-white font-bold">WINTER 2025</div>
                <h1 class="text-5xl font-black mb-6 text-white hero-anim">DESIGN YOUR<br>AESTHETIC.</h1>
                <button onclick="switchView('shop')" class="bg-white text-black px-8 py-3 rounded-full font-bold hero-anim">Shop Now</button>
            </div>
        </section>

        <section id="shop-view" class="section-hidden min-h-screen pt-24 px-4 bg-white z-40">
            <h2 class="text-3xl font-black mb-2">Shop</h2>
            <div id="brand-filters" class="flex gap-2 overflow-x-auto mb-6 pb-2"></div>
            <input type="text" id="search-input" onkeyup="handleSearch()" placeholder="Search items..." class="w-full p-3 bg-gray-50 rounded-xl mb-6">
            <div id="product-grid" class="grid grid-cols-1 gap-6 pb-20"></div>
        </section>

        <section id="wishlist-view" class="section-hidden min-h-screen pt-24 px-4 bg-white z-40">
            <h2 class="text-3xl font-black mb-6">Wishlist</h2>
            <div id="wishlist-grid" class="grid grid-cols-1 gap-6 pb-20"></div>
        </section>

        <section id="cart-view" class="section-hidden min-h-screen pt-24 px-4 bg-white z-40">
            <h2 class="text-3xl font-black mb-6">Cart</h2>
            <div id="cart-items-container" class="mb-6"></div>
            <div class="border-t pt-4">
                <div class="flex justify-between font-bold text-lg mb-4"><span>Total</span><span id="cart-total">₹0</span></div>
                <button onclick="switchView('checkout')" class="w-full bg-black text-white font-bold py-3 rounded-full">Checkout</button>
            </div>
        </section>

        <section id="checkout-view" class="section-hidden min-h-screen pt-24 px-4 bg-white z-40">
            <button onclick="switchView('cart')" class="mb-4 font-bold flex gap-2 items-center"><i class="ph ph-arrow-left"></i> Back</button>
            <h2 class="text-2xl font-black mb-6">Checkout</h2>
            <form onsubmit="handleCheckout(event)" class="space-y-4 pb-20">
                <input id="checkout-fname" required placeholder="First Name" class="w-full p-3 border rounded-lg">
                <input id="checkout-lname" required placeholder="Last Name" class="w-full p-3 border rounded-lg">
                <input id="checkout-address" required placeholder="Address" class="w-full p-3 border rounded-lg">
                <div class="grid grid-cols-2 gap-4">
                    <input id="checkout-city" required placeholder="City" class="p-3 border rounded-lg">
                    <input id="checkout-zip" required placeholder="Zip" class="p-3 border rounded-lg">
                </div>
                <input id="checkout-phone" required placeholder="Phone" class="w-full p-3 border rounded-lg">
                
                <div class="pt-4 border-t">
                    <p class="font-bold mb-3">Payment Method</p>
                    <label class="flex items-center p-3 border rounded-lg mb-3">
                        <input type="radio" name="payment" value="Online" checked class="mr-3"> Online (UPI/QR)
                    </label>
                    <label class="flex items-center p-3 border rounded-lg">
                        <input type="radio" name="payment" value="COD" class="mr-3"> Cash on Delivery
                    </label>
                </div>
                
                <button type="submit" class="w-full bg-black text-white font-bold py-4 rounded-full mt-4">Place Order</button>
            </form>
        </section>

        <section id="profile-view" class="section-hidden min-h-screen pt-24 px-4 bg-white z-40">
            <h2 class="text-3xl font-black mb-2" id="display-name">Guest</h2>
            <p class="text-gray-500 mb-6">Member</p>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-gray-50 p-4 rounded-xl text-center"><div class="text-2xl font-black" id="profile-order-count">0</div><div class="text-xs uppercase font-bold text-gray-500">Orders</div></div>
                <div class="bg-gray-50 p-4 rounded-xl text-center"><div class="text-2xl font-black" id="profile-wishlist-count">0</div><div class="text-xs uppercase font-bold text-gray-500">Wishlist</div></div>
            </div>
            <button onclick="logout()" class="w-full py-3 border border-red-500 text-red-500 font-bold rounded-lg">Sign Out</button>
        </section>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, serverTimestamp, query, where, getDocs, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- ⚠️ PASTE YOUR KEYS HERE ⚠️ ---
        const firebaseConfig = {
            apiKey: "AIzaSyAVAhzIDoiFiGxHN0z2ze9TSocB3Cbb6i8",
  authDomain: "shop-clothes-aded9.firebaseapp.com",
  projectId: "shop-clothes-aded9",
  storageBucket: "shop-clothes-aded9.firebasestorage.app",
  messagingSenderId: "119802803208",
  appId: "1:119802803208:web:984c947412580274268dbd",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Export to Global Scope
        window.auth = auth; 
        window.db = db; 
        window.collection = collection; 
        window.addDoc = addDoc; 
        window.serverTimestamp = serverTimestamp;

        // FETCH PRODUCTS DYNAMICALLY
        const q = query(collection(db, "products"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            window.products = [];
            snapshot.forEach(doc => {
                window.products.push({ id: doc.id, ...doc.data() });
            });
            // Initial render if on shop page
            if(!document.getElementById('shop-view').classList.contains('section-hidden')) {
                window.renderProducts('All');
            }
        });

        // Auth Listeners
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const docSnap = await getDoc(doc(db, "users", user.uid));
                if (docSnap.exists()) {
                    const d = docSnap.data();
                    localStorage.setItem('importHouseUser', JSON.stringify({ name: d.firstName, surname: d.lastName }));
                    document.getElementById('display-name').innerText = `${d.firstName} ${d.lastName}`;
                }
                
                // Fetch Order Count
                const orderQ = query(collection(db, "orders"), where("userId", "==", user.uid));
                const orderSnap = await getDocs(orderQ);
                document.getElementById('profile-order-count').innerText = orderSnap.size;

                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('intro-overlay').style.display = 'none';
                window.switchView('home');
            }
        });

        // Auth Functions
        window.handleSignup = async (e) => {
            e.preventDefault();
            try {
                const c = await createUserWithEmailAndPassword(auth, document.getElementById('reg-email').value, document.getElementById('reg-password').value);
                await setDoc(doc(db, "users", c.user.uid), { firstName: document.getElementById('reg-name').value, lastName: document.getElementById('reg-surname').value });
                location.reload();
            } catch(e) { alert(e.message); }
        };

        window.handleLogin = async (e) => {
            e.preventDefault();
            try { await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value); } 
            catch(e) { alert(e.message); }
        };

        window.logout = async () => { await signOut(auth); localStorage.removeItem('importHouseUser'); location.reload(); };
    </script>

    <script>
        // Global State
        window.products = []; // Populated by Firebase
        window.cartItems = JSON.parse(localStorage.getItem('importHouseCart')) || [];
        window.wishlistItems = JSON.parse(localStorage.getItem('importHouseWishlist')) || [];
        let currentBrand = 'All';
        let currentSlide = 0;

        // Init
        window.addEventListener('load', () => {
            closeModal('payment-modal'); // Ensure modal is closed on load
            closeModal('success-modal');
            updateBadges();
            
            // Check Local Storage User
            const u = JSON.parse(localStorage.getItem('importHouseUser'));
            if(u) document.getElementById('display-name').innerText = `${u.name} ${u.surname}`;
            
            // Intro Anim
            setTimeout(() => {
                if(!document.querySelector('#auth-container').classList.contains('hidden')) return;
                gsap.to("#door-left", {x:"-100%", duration:1.5});
                gsap.to("#door-right", {x:"100%", duration:1.5},"<");
                gsap.to("#intro-overlay", {display:"none", delay:1.5});
            }, 500);
            
            // Start Slider
            setInterval(nextSlide, 4000);
        });

        // Navigation
        window.switchView = (v) => {
            window.scrollTo(0,0);
            document.querySelectorAll('section').forEach(el => {
                el.classList.add('section-hidden');
                el.classList.remove('section-active');
            });
            const target = document.getElementById(v+'-view');
            if(target) { target.classList.remove('section-hidden'); target.classList.add('section-active'); }
            
            if(v === 'home') document.getElementById('snow-container').style.display = 'block';
            else document.getElementById('snow-container').style.display = 'none';

            if(v === 'shop') renderProducts(currentBrand);
            if(v === 'cart') renderCart();
            if(v === 'wishlist') renderWishlist();
        };

        // Render Functions
        window.renderProducts = (brand) => {
            currentBrand = brand;
            const term = document.getElementById('search-input')?.value.toLowerCase() || '';
            const grid = document.getElementById('product-grid');
            if(!grid) return;
            
            grid.innerHTML = "";
            const filtered = window.products.filter(p => (brand === 'All' || p.brand === brand) && p.name.toLowerCase().includes(term));
            
            if(window.products.length === 0) { grid.innerHTML = '<p class="text-center text-gray-500">Loading...</p>'; return; }
            if(filtered.length === 0) { grid.innerHTML = '<p class="text-center text-gray-500">No items found.</p>'; return; }

            filtered.forEach(p => {
                const isWish = window.wishlistItems.some(x => x.id === p.id);
                grid.innerHTML += `
                    <div class="group relative bg-gray-50 rounded-2xl overflow-hidden">
                        <div class="aspect-[3/4]"><img src="${p.img}" class="w-full h-full object-cover"></div>
                        <div class="p-3">
                            <div class="flex justify-between items-start">
                                <div><h3 class="font-bold text-sm">${p.name}</h3><p class="text-xs text-gray-500">${p.brand}</p></div>
                                <p class="font-bold text-sm">₹${p.price}</p>
                            </div>
                            <div class="flex gap-2 mt-3">
                                <button onclick="toggleWish('${p.id}')" class="flex-1 py-2 rounded-lg border ${isWish ? 'bg-red-50 border-red-200 text-red-500' : 'border-gray-200'} flex justify-center"><i class="ph ${isWish ? 'ph-heart-fill' : 'ph-heart'}"></i></button>
                                <button onclick="addCart('${p.id}')" class="flex-[3] py-2 bg-black text-white rounded-lg text-sm font-bold">Add</button>
                            </div>
                        </div>
                    </div>`;
            });
        };

        // Actions
        window.addCart = (id) => {
            const p = window.products.find(x => x.id === id);
            if(p) { 
                window.cartItems.push(p); 
                localStorage.setItem('importHouseCart', JSON.stringify(window.cartItems));
                updateBadges(); alert('Added to Bag');
            }
        };

        window.toggleWish = (id) => {
            const p = window.products.find(x => x.id === id);
            const idx = window.wishlistItems.findIndex(x => x.id === id);
            if(idx > -1) window.wishlistItems.splice(idx, 1);
            else if(p) window.wishlistItems.push(p);
            
            localStorage.setItem('importHouseWishlist', JSON.stringify(window.wishlistItems));
            updateBadges(); 
            if(!document.getElementById('shop-view').classList.contains('section-hidden')) renderProducts(currentBrand);
            if(!document.getElementById('wishlist-view').classList.contains('section-hidden')) renderWishlist();
        };

        function renderCart() {
            const c = document.getElementById('cart-items-container');
            if(!c) return;
            if(window.cartItems.length === 0) {
                c.innerHTML = '<p class="text-center text-gray-500 py-10">Empty.</p>';
                document.getElementById('cart-total').innerText = "₹0";
                return;
            }
            let t = 0;
            c.innerHTML = window.cartItems.map((p, i) => {
                t += Number(p.price);
                return `<div class="flex gap-3 mb-4 border-b pb-4">
                    <img src="${p.img}" class="w-16 h-20 object-cover rounded-lg">
                    <div class="flex-1">
                        <h4 class="font-bold text-sm">${p.name}</h4>
                        <p class="text-sm">₹${p.price}</p>
                        <button onclick="removeCart(${i})" class="text-xs text-red-500 mt-1">Remove</button>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('cart-total').innerText = "₹" + t;
            if(document.getElementById('modal-total')) document.getElementById('modal-total').innerText = "₹" + t;
        }

        window.removeCart = (i) => {
            window.cartItems.splice(i, 1);
            localStorage.setItem('importHouseCart', JSON.stringify(window.cartItems));
            renderCart(); updateBadges();
        };

        function renderWishlist() {
            const g = document.getElementById('wishlist-grid');
            if(window.wishlistItems.length === 0) { g.innerHTML = '<p class="text-center text-gray-500">Empty.</p>'; return; }
            g.innerHTML = window.wishlistItems.map(p => `
                <div class="flex gap-3 items-center border-b pb-4">
                    <img src="${p.img}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1"><h4 class="font-bold text-sm">${p.name}</h4><p class="text-xs">₹${p.price}</p></div>
                    <button onclick="addCart('${p.id}')" class="text-xs bg-black text-white px-3 py-1 rounded">Add</button>
                </div>`).join('');
        }

        function updateBadges() {
            const b = document.getElementById('cart-badge');
            if(b) { b.innerText = window.cartItems.length; b.classList.toggle('hidden', window.cartItems.length === 0); }
            if(document.getElementById('profile-wishlist-count')) document.getElementById('profile-wishlist-count').innerText = window.wishlistItems.length;
        }

        // --- CHECKOUT & MODAL LOGIC (FIXED) ---
        window.closeModal = (id) => {
            const el = document.getElementById(id);
            if(el) { el.classList.add('hidden'); el.classList.remove('flex'); }
        };

        window.resetApp = () => {
            window.closeModal('success-modal');
            window.switchView('home');
        };

        window.handleCheckout = (e) => {
            e.preventDefault();
            if(window.cartItems.length === 0) { alert("Cart is empty"); return; }
            const method = document.querySelector('input[name="payment"]:checked').value;
            if(method === 'COD') processOrder('COD');
            else {
                const m = document.getElementById('payment-modal');
                if(m) { m.classList.remove('hidden'); m.classList.add('flex'); }
            }
        };

        window.processOrder = async (method) => {
            if(method === 'Online') window.closeModal('payment-modal');
            
            const btn = document.querySelector('#checkout-view button[type="submit"]');
            if(btn) btn.innerText = "Processing...";

            let t = 0; window.cartItems.forEach(i => t += Number(i.price));
            
            const order = {
                userId: window.auth.currentUser ? window.auth.currentUser.uid : "guest",
                customer: {
                    firstName: document.getElementById('checkout-fname').value,
                    lastName: document.getElementById('checkout-lname').value,
                    address: document.getElementById('checkout-address').value,
                    city: document.getElementById('checkout-city').value,
                    zip: document.getElementById('checkout-zip').value,
                    phone: document.getElementById('checkout-phone').value
                },
                items: window.cartItems,
                totalAmount: t,
                paymentStatus: method === 'Online' ? "Paid Online" : "COD",
                status: "Pending",
                timestamp: window.serverTimestamp()
            };

            try {
                await window.addDoc(window.collection(window.db, "orders"), order);
                window.cartItems = [];
                localStorage.removeItem('importHouseCart');
                updateBadges(); renderCart();
                
                const s = document.getElementById('success-modal');
                if(s) { s.classList.remove('hidden'); s.classList.add('flex'); }
            } catch(e) { 
                alert("Error: " + e.message); 
            } finally {
                if(btn) btn.innerText = "Place Order";
            }
        };

        // Slider Logic
        function nextSlide() { 
            currentSlide = (currentSlide < 2) ? currentSlide + 1 : 0; 
            document.getElementById('slider-track').style.transform = `translateX(-${currentSlide * 100}%)`; 
        }
        function prevSlide() { 
            currentSlide = (currentSlide > 0) ? currentSlide - 1 : 2; 
            document.getElementById('slider-track').style.transform = `translateX(-${currentSlide * 100}%)`; 
        }
        function createSnowflakes() {
            const c = document.getElementById('snow-container');
            if(!c) return;
            c.innerHTML = '';
            for(let i=0; i<30; i++){
                const d = document.createElement('div'); d.className='snowflake';
                d.style.left = Math.random()*100+'vw'; d.style.animationDuration = Math.random()*3+2+'s';
                c.appendChild(d);
            }
        }
        window.nextSlide = nextSlide; window.prevSlide = prevSlide;
        
        function toggleAuth(mode) {
            if(mode==='signup') { document.getElementById('login-form').classList.add('hidden'); document.getElementById('signup-form').classList.remove('hidden'); }
            else { document.getElementById('signup-form').classList.add('hidden'); document.getElementById('login-form').classList.remove('hidden'); }
        }
        window.toggleAuth = toggleAuth;
    </script>
</body>
</html>
